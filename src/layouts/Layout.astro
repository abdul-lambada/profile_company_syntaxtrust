---
import "../styles/global.css";

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
}

const {
  title,
  description = "SyntaxTrust - Solusi IT premium untuk Sistem Keuangan Sekolah dan Jasa Pembuatan Website Kustom dengan teknologi modern.",
  ogImage = "/logo.jpg",
} = Astro.props;

// Ambil pengaturan situs
const resSettings = await fetch(
  "http://localhost/profile_syntaxtrust/api/data.php?aksi=pengaturan",
).catch(() => null);
const settings = resSettings
  ? await resSettings.json()
  : {
      nama_situs: "SyntaxTrust",
      wa_number: "628123456789",
      email_kontak: "info@syntaxtrust.com",
      deskripsi_footer:
        "Membangun masa depan digital Indonesia melalui solusi IT yang presisi dan visioner.",
    };

// Pisahkan nama situs untuk styling (Contoh: "Syntax" + "Trust")
const nameParts = settings.nama_situs.split(/(?=[A-Z])/);
const brandMain = nameParts[0] || "Syntax";
const brandAccent = nameParts.slice(1).join("") || "Trust";
---

<!doctype html>
<html lang="id" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/jpeg" href="/logo.jpg" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO Meta Tags -->
    <title>{title} | {settings.nama_situs}</title>
    <meta name="description" content={description} />
    <meta name="robots" content="index, follow" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={Astro.url} />
    <meta property="og:title" content={`${title} | ${settings.nama_situs}`} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(ogImage, Astro.url)} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={Astro.url} />
    <meta
      property="twitter:title"
      content={`${title} | ${settings.nama_situs}`}
    />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={new URL(ogImage, Astro.url)} />

    <link rel="canonical" href={Astro.url} />

    <!-- Leaflet Map Assets -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" is:inline
    ></script>
  </head>
  <body
    class="bg-syntax-dark selection:bg-syntax-accent/30 selection:text-white"
  >
    <!-- WhatsApp Floating Button -->
    <a
      href={`https://wa.me/${settings.wa_number}`}
      target="_blank"
      class="fixed bottom-8 left-8 z-[100] group"
      aria-label="Chat WhatsApp"
    >
      <div
        class="absolute -inset-4 bg-green-500/20 rounded-full blur-xl group-hover:bg-green-500/40 transition-colors animate-pulse"
      >
      </div>
      <div
        class="relative w-16 h-16 bg-[#25D366] rounded-full flex items-center justify-center shadow-2xl transform group-hover:scale-110 group-hover:-rotate-12 transition-all"
      >
        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.246 2.248 3.484 5.232 3.484 8.412-.003 6.557-5.338 11.892-11.893 11.892-1.997-.001-3.951-.5-5.688-1.448l-6.309 1.656zm6.29-4.171c1.533.913 3.391 1.396 5.282 1.397 5.239 0 9.503-4.263 9.505-9.504.001-2.541-.99-4.93-2.791-6.731-1.801-1.802-4.184-2.795-6.724-2.796-5.245 0-9.503 4.263-9.506 9.505-.001 1.963.513 3.88 1.483 5.511l-1.01 3.687 3.761-.987zm11.389-5.408c-.191-.096-1.127-.557-1.302-.622-.174-.064-.3-.096-.426.096-.126.192-.489.622-.599.749-.11.127-.221.144-.412.048-.191-.096-.803-.297-1.53-.945-.566-.505-.948-1.129-1.059-1.32-.11-.192-.012-.296.084-.391.087-.085.191-.223.287-.335.095-.112.127-.191.191-.319.064-.128.032-.24-.016-.336-.048-.096-.426-1.025-.584-1.405-.154-.369-.304-.319-.426-.325l-.364-.006c-.127 0-.317.048-.483.223-.166.176-.634.622-.634 1.516 0 .894.65 1.756.741 1.884.091.127 1.277 1.949 3.094 2.733.432.187.769.298 1.031.382.433.137.827.117 1.139.07.348-.053 1.127-.462 1.285-.908.158-.447.158-.83.11-.908-.047-.079-.174-.127-.365-.223z"
          ></path></svg
        >
      </div>
    </a>

    <!-- Navigation -->
    <nav
      id="navbar"
      class="fixed top-0 left-0 right-0 z-50 transition-all duration-500 py-6"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div
          class="glass-header rounded-3xl border border-white/5 px-6 shadow-2xl"
        >
          <div class="flex items-center justify-between h-20">
            <div class="flex items-center">
              <a href="/" class="flex items-center space-x-3 group">
                <img
                  src="/logo.jpg"
                  alt="Logo"
                  class="w-12 h-12 rounded-xl object-contain shadow-lg transition-transform group-hover:scale-110"
                />
                <span class="text-2xl font-black tracking-tighter text-white"
                  >{brandMain}<span
                    class="text-[#00A859] group-hover:text-white transition-colors"
                    >{brandAccent}</span
                  ></span
                >
              </a>
            </div>

            <!-- Desktop Menu -->
            <div class="hidden md:block">
              <div class="flex items-center space-x-1">
                {
                  [
                    { name: "Home", path: "/" },
                    { name: "Tentang", path: "/tentang" },
                    { name: "Layanan", path: "/layanan" },
                    { name: "Panduan", path: "/panduan" },
                  ].map((item) => (
                    <a
                      href={item.path}
                      class="text-gray-400 hover:text-white px-5 py-2 rounded-xl text-sm font-bold transition-all hover:bg-white/5"
                    >
                      {item.name}
                    </a>
                  ))
                }
                <div class="w-px h-6 bg-white/10 mx-4"></div>
                <a
                  href={`https://wa.me/${settings.wa_number}`}
                  target="_blank"
                  class="bg-syntax-accent hover:bg-syntax-accent-light text-white px-7 py-3 rounded-2xl text-sm font-black transition-all shadow-xl shadow-syntax-accent/30 hover:scale-105 active:scale-95"
                >
                  Hubungi Kami
                </a>
              </div>
            </div>

            <!-- Mobile Menu Toggle -->
            <div class="md:hidden">
              <button
                id="menu-toggle"
                class="p-2 rounded-xl text-gray-400 hover:text-white hover:bg-white/5 transition-colors focus:outline-none"
              >
                <svg
                  id="menu-icon"
                  class="h-7 w-7"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2.5"
                    d="M4 8h16M4 16h16"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Menu Dropdown -->
      <div
        id="mobile-menu"
        class="hidden absolute top-full left-0 right-0 px-4 pt-2 pb-6 md:hidden"
      >
        <div
          class="glass rounded-[2rem] border border-white/10 p-6 space-y-4 shadow-2xl"
        >
          {
            [
              { name: "Home", path: "/" },
              { name: "Tentang", path: "/tentang" },
              { name: "Layanan", path: "/layanan" },
              { name: "Panduan", path: "/panduan" },
            ].map((item) => (
              <a
                href={item.path}
                class="block text-gray-300 hover:text-white px-4 py-3 rounded-2xl text-lg font-bold hover:bg-white/5 transition-all"
              >
                {item.name}
              </a>
            ))
          }
          <a
            href={`https://wa.me/${settings.wa_number}`}
            target="_blank"
            class="block w-full bg-syntax-accent text-white text-center py-4 rounded-2xl font-black shadow-lg"
          >
            Hubungi Kami
          </a>
        </div>
      </div>
    </nav>

    <main class="min-h-screen">
      <slot />
    </main>

    <!-- Footer Content -->
    <footer
      class="pt-32 pb-16 relative overflow-hidden border-t border-white/5 bg-black"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <div class="grid grid-cols-1 md:grid-cols-12 gap-16 mb-24">
          <div class="md:col-span-4 space-y-8">
            <a href="/" class="flex items-center space-x-4">
              <img
                src="/logo.jpg"
                alt="Logo"
                class="w-12 h-12 rounded-2xl object-cover"
              />
              <span class="text-2xl font-black text-white tracking-widest"
                >{brandMain}<span class="text-syntax-emerald"
                  >{brandAccent}</span
                ></span
              >
            </a>
            <p class="text-gray-500 font-medium leading-relaxed">
              {settings.deskripsi_footer}
            </p>
          </div>

          <div class="md:col-span-4 grid grid-cols-2 gap-8">
            <div>
              <h4
                class="text-white font-black text-xs uppercase tracking-[0.3em] mb-8"
              >
                Navigasi
              </h4>
              <ul class="space-y-4">
                <li>
                  <a
                    href="/"
                    class="text-gray-500 hover:text-white transition-colors font-bold text-sm"
                    >Home</a
                  >
                </li>
                <li>
                  <a
                    href="/tentang"
                    class="text-gray-500 hover:text-white transition-colors font-bold text-sm"
                    >Tentang</a
                  >
                </li>
                <li>
                  <a
                    href="/layanan"
                    class="text-gray-500 hover:text-white transition-colors font-bold text-sm"
                    >Layanan</a
                  >
                </li>
              </ul>
            </div>
            <div>
              <h4
                class="text-white font-black text-xs uppercase tracking-[0.3em] mb-8"
              >
                Produk
              </h4>
              <ul class="space-y-4">
                <li>
                  <a
                    href="/layanan"
                    class="text-gray-500 hover:text-white transition-colors font-bold text-sm"
                    >Sistem Keuangan</a
                  >
                </li>
                <li>
                  <a
                    href="/layanan"
                    class="text-gray-500 hover:text-white transition-colors font-bold text-sm"
                    >Custom Web</a
                  >
                </li>
                <li>
                  <a
                    href="/panduan"
                    class="text-gray-500 hover:text-white transition-colors font-bold text-sm"
                    >Panduan</a
                  >
                </li>
              </ul>
            </div>
          </div>

          <div class="md:col-span-4">
            <h4
              class="text-white font-black text-xs uppercase tracking-[0.3em] mb-8"
            >
              Lokasi Kantor
            </h4>
            <div
              class="glass p-1 rounded-3xl border border-white/10 overflow-hidden aspect-video relative group"
            >
              <iframe
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3966.2917392!2d106.8166!3d-6.2297!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zNsKwMTMnNDYuOSJTIDEwNsKwNDknMDAuMCJF!5e0!3m2!1sen!2sid!4v1620000000000"
                class="w-full h-full grayscale opacity-50 group-hover:grayscale-0 group-hover:opacity-100 transition-all duration-700"
                style="border:0;"
                allowfullscreen=""
                loading="lazy"
              >
              </iframe>
            </div>
            <p class="mt-6 text-gray-500 text-xs font-bold leading-relaxed">
              Sudirman Central Business District (SCBD), <br /> Jakarta Selatan, Indonesia
            </p>
          </div>
        </div>
        <div class="pt-16 border-t border-white/5 text-center">
          <p class="text-gray-600 font-bold text-xs uppercase tracking-widest">
            &copy; {new Date().getFullYear()}
            {settings.nama_situs}. Manufactured with ❤️ in Indonesia.
          </p>
        </div>
      </div>
    </footer>

    <!-- Scroll to top -->
    <button
      id="scroll-top"
      class="fixed bottom-10 right-10 w-14 h-14 rounded-2xl bg-black/80 backdrop-blur-md border border-white/10 text-white flex items-center justify-center opacity-0 translate-y-10 transition-all duration-500 z-50 hover:bg-syntax-accent hover:border-syntax-accent shadow-2xl invisible"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
        ><path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="3"
          d="M5 15l7-7 7 7"></path></svg
      >
    </button>

    <script is:inline>
      const menuToggle = document.getElementById("menu-toggle");
      const mobileMenu = document.getElementById("mobile-menu");
      const navbar = document.getElementById("navbar");
      const scrollTop = document.getElementById("scroll-top");

      menuToggle?.addEventListener("click", () => {
        mobileMenu?.classList.toggle("hidden");
      });

      window.addEventListener("scroll", () => {
        if (window.scrollY > 50) {
          navbar?.classList.add("py-4");
          navbar
            ?.querySelector(".glass-header")
            ?.classList.add("shadow-syntax-accent/5");
          scrollTop?.classList.remove(
            "opacity-0",
            "translate-y-10",
            "invisible",
          );
        } else {
          navbar?.classList.remove("py-4");
          navbar
            ?.querySelector(".glass-header")
            ?.classList.remove("shadow-syntax-accent/5");
          scrollTop?.classList.add("opacity-0", "translate-y-10", "invisible");
        }
      });

      scrollTop?.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      const revealItems = document.querySelectorAll(".reveal-on-scroll");
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("active");
            }
          });
        },
        { threshold: 0.1 },
      );
      revealItems.forEach((item) => observer.observe(item));
    </script>
  </body>
</html>
